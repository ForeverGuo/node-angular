var image = {};
var fs = require('fs');  
var images = require('images');
  
image.add = function(imgData, callback){  
        var base64 = imgData.indexOf("upload");
     if(base64 == -1){
        var flag = imgData.indexOf('png');
        var base64Data = imgData.replace(/^data:image\/\w+;base64,/, "");
        var dataBuffer = new Buffer(base64Data, 'base64');
        if(flag == 1){var text = "../upload/expostor"+Math.random()+".png"}else{text = "../upload/expostor"+Math.random()+".jpg"}
        fs.writeFile("static/upload/"+text, dataBuffer, function(err) {
             if(err){
                  callback(err);
               };
              //callback(text);
         });
    
        return text;   
    }else{
        return imgData;
     }
    

}

image.del = function(imageSrc,callback){
	    fs.unlink("static/upload/"+imageSrc,function(err){
            if(err){
                return console.error(err);
            }
            console.log("文件删除成功");
        });
	
}
image.addVideo = function(video, callback){  
        var base64 = video.indexOf("upload");
     if(base64 == -1){
        var flag = video.indexOf('audio');
        var base64Data = video.replace(/^data:audio\/\w+;base64,/, "");
        //var base64Data = video.replace("data:audio/mp3;base64,","");
        var dataBuffer = new Buffer(base64Data, 'base64');
        if(flag > -1){var videoText = "../upload/expostor"+Math.random()+".mp3"}
        fs.writeFile("static/upload/"+videoText, dataBuffer, function(err) {
             if(err){
                  callback(err);
               };
              //callback(text);
         });
    
        return videoText;   
    }else{
        return videoText;
     }
    

}
image.delVideo = function(video,callback){
	    fs.unlink("static/upload/"+video,function(err){
            if(err){
                return console.error(err);
            }
            console.log("文件删除成功");
        });
	
}
module.exports = image;  
